version: 0.2

phases:
  install:
    commands:
      - sudo yum install -y wget tar

  build:
    commands:
      - wget https://github.com/filebrowser/filebrowser/releases/download/v2.32.0/linux-amd64-filebrowser.tar.gz
      - tar -xvf linux-amd64-filebrowser.tar.gz
      - sudo mv filebrowser /usr/local/bin/
      - sudo chmod +x /usr/local/bin/filebrowser

  post_build:
    commands:
      - |
        sudo tee /etc/systemd/system/filebrowser.service > /dev/null <<EOF
        [Unit]
        Description=File Browser
        After=network.target

        [Service]
        ExecStart=/usr/local/bin/filebrowser -r /home/ec2-user/filebrowser -p 8080
        Restart=always
        User=ec2-user
        Group=ec2-user

        [Install]
        WantedBy=multi-user.target
        EOF
      - sudo systemctl daemon-reload
      - sudo systemctl enable filebrowser
      - sudo systemctl start filebrowser

artifacts:
  files:
    - filebrowser.log
